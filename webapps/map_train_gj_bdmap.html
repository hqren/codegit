<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="expires" content="0"><meta http-equiv="pragma" content="no-cache"><meta http-equiv="cache-control" content="no-cache"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title></title><link rel="stylesheet" href="css/bootstrap.min.css?v=1482488294000"><link rel="stylesheet" href="css/bootstrap-table.css?v=1482488294000"><link rel="stylesheet" href="css/bootstrap-select.min.css?v=1482488294000"><link rel="stylesheet" href="css/bootstrap-dialog.min.css?v=1482488294000"><link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css?v=1482488294000"><link rel="stylesheet" href="css/bootstrapValidator.min.css?v=1482488294000"><link rel="stylesheet" href="css/fileinput.min.css?v=1482488294000"><link rel="stylesheet" href="css/font-awesome.min.css?v=1482488294000"><!--[if IE 7]>
    <link rel="stylesheet" href="css/font-awesome-ie7.min.css?v=1482488294000">
    <![endif]--><link rel="stylesheet" href="css/ladda-themeless.min.css?v=1482488294000"><link rel="stylesheet" href="css/animate.min.css?v=1482488294000"><link rel="stylesheet" href="css/main.css?v=1482488294000"><style>#BDMap,#allmap,body,html{width:100%;height:100%;overflow:hidden;margin:0;font-family:"微软雅黑"}#BDMap{position:relative}#BDMapRight{width:320px;position:absolute;z-index:999;left:50px;top:50px;background-color:#FFF}#BDMapRight .panel-heading{cursor:pointer}.monitorListItem{width:100%;height:34px;display:block;line-height:35px;border-bottom:1px dashed #eee;cursor:pointer}.monitorListItemName{width:150px;float:left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.monitorListItemSpeed{float:right;width:80px;height:100%;text-align:rgiht;padding-right:10px}.monitorListItem i{display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;opacity:.8;background-color:#eee}.monitorListItem.active:nth-child(1) i{background:#2ec7c9}.monitorListItem.active:nth-child(2) i{background:#b6a2de}.monitorListItem.active:nth-child(3) i{background:#5ab1ef}.monitorListItem.active:nth-child(4) i{background:#ffb980}label.BMapLabel{max-width:none}</style><script src="http://api.map.baidu.com/api?v=2.0&ak=qhtMIgNMS2ktirf4eWuVACvgU70F0u0w"></script><title>添加多个标注点</title></head><body><div style="height:100%"><div class="container-fluid"><div class="table row"><div class="col-sm-12"><from class="form-horizontal"><br><div class="col-sm-2"><div class="input-group"><input type="text" class="form-control" id="datetimeStart" placeholder="开始日期" readonly><div class="input-group-btn"><button class="btn btn-primary" type="submit"><i class="glyphicon glyphicon-calendar"></i></button></div></div></div><div class="col-sm-2"><div class="input-group"><input type="text" class="form-control" id="datetimeEnd" placeholder="结束日期" readonly><div class="input-group-btn"><button class="btn btn-primary" type="submit"><i class="glyphicon glyphicon-calendar"></i></button></div></div></div><div class="col-sm-4"><div class="input-group"><input type="text" class="form-control" placeholder="请输入设备MAC地址" name="q"><div class="input-group-btn"><button class="btn btn-primary" type="submit"><i class="glyphicon glyphicon-search"></i></button></div></div></div></from></div></div></div><div id="BDMap"><div id="BDMapRight" class="panel panel-primary"><div class="panel-heading"><span id="BDMapRightIco" class="pull-right icon-angle-up icon-large"></span><h3 class="panel-title text-center">设备列表</h3></div><div id="BDMapRightBody" class="panel-body"></div></div><div id="allmap"></div></div></div><!--[if IE]>
	<script src="js/html5.js?v=1482488294000"></script>
	<![endif]--><script src="js/jquery.min.js?v=1482488294000"></script><script src="js/bootstrap.min.js?v=1482488294000"></script><script src="js/jquery.session.js?v=1482488294000"></script><script src="js/jquery.cookie.min.js?v=1482488294000"></script><script src="js/bootstrap-table.js?v=1482488294000"></script><script src="js/bootstrap-table-zh-CN.js?v=1482488294000"></script><script src="js/layer.js?v=1482488294000"></script><script src="js/bootstrap-select.min.js?v=1482488294000"></script><script src="js/i18n/defaults-zh_CN.min.js?v=1482488294000"></script><script src="js/bootstrap-dialog.min.js?v=1482488294000"></script><script src="js/bootstrap-datetimepicker.min.js?v=1482488294000"></script><script src="js/locales/bootstrap-datetimepicker.zh-CN.js?v=1482488294000"></script><script src="js/bootstrapValidator.min.js?v=1482488294000"></script><script src="js/main.js?v=1482488294000"></script><script src="js/fileinput.min.js?v=1482488294000"></script><script src="js/locales/zh.js?v=1482488294000"></script><script src="js/bootstrap-notify.min.js?v=1482488294000"></script><script src="js/spin.min.js?v=1482488294000"></script><script src="js/ladda.min.js?v=1482488294000"></script><script src="js/moment.js?v=1482488294000"></script><script>function GetBaiDu(){var a=new BMap.Map("allmap");a.centerAndZoom("中国",5),a.setMapStyle({style:"bluish"}),a.enableScrollWheelZoom();var e=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT}),t=new BMap.NavigationControl,o=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});$.ajax({type:"get",url:"json/getHistoryListByMacs.json",contentType:"application/json",dataType:"json",success:function(e){function t(e,t){var o=t.point,n=new BMap.Point(o.lng,o.lat);e+=o.content+'<div>所在位置：<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+o.lng+","+o.lat,contentType:"application/json",dataType:"json",success:function(a){console.log(a.regeocode.formatted_address),$("#geoStr").html(a.regeocode.formatted_address)},error:function(){BootstrapDialog.show({title:"系统提示",message:"无法获取返回数据，请刷新页面！",buttons:[{label:"关闭",action:function(a){a.close()}}]})}});var i=new BMap.InfoWindow(e,opts);a.openInfoWindow(i,n)}var o="";MacsArray=[],MacsDataArray=[],TempMacsArray=[],points=[];for(var n in e)""!=e[n]&&MacsArray.push(n);MacsArray=MacsArray.slice(0,4),TempMacsArray=MacsArray,$.each(MacsArray,function(t,n){MacsDataArray.push(e[n]),o+='<div class="monitorListItem active"><div class="monitorListItemName"><i> </i>'+n+'</div><div class="monitorListItemSpeed"></div></div>';var i=[];$.each(e[n],function(t,o){var r=new BMap.Point(o.longitude,o.latitude);r.content="<div>MAC："+o.mac+"</div><div>时间："+moment(o.date).format("YYYY-MM-DD HH:mm:ss")+"</div>",i.push(r),points.push(r);new BMap.Marker(r);if(0==t){var s=new BMap.Marker(r,{icon:startIcon});a.addOverlay(s)}else if(t==e[n].length-1){var c=new BMap.Marker(r,{icon:endIcon});a.addOverlay(c)}});var r=new BMap.Polyline(i,{strokeColor:colorPalette[t],strokeWeight:4,strokeOpacity:.8});a.addOverlay(r)}),$("#BDMapRightBody").html(o),$(".monitorListItem").click(function(){$(".monitorListItem").removeClass("active"),$(this).addClass("active"),GetBaiDu2($(this).find(".monitorListItemName").text().trim())});var i=new BMap.PointCollection(points,options);i.addEventListener("mouseover",function(a){t("",a)}),a.addOverlay(i)},error:function(){BootstrapDialog.show({title:"系统提示",message:"无法获取返回数据，请刷新页面！",buttons:[{label:"关闭",action:function(a){a.close()}}]})}}),a.addControl(e),a.addControl(t),a.addControl(o)}function GetBaiDu2(a){function e(a,e){var o=e.point,n=new BMap.Point(o.lng,o.lat);a+=o.content+'<div>所在位置：<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+o.lng+","+o.lat,contentType:"application/json",dataType:"json",success:function(a){console.log(a.regeocode.formatted_address),$("#geoStr").html(a.regeocode.formatted_address)},error:function(){BootstrapDialog.show({title:"系统提示",message:"无法获取返回数据，请刷新页面！",buttons:[{label:"关闭",action:function(a){a.close()}}]})}});var i=new BMap.InfoWindow(a,opts);t.openInfoWindow(i,n)}a=String(a);var t=new BMap.Map("allmap");t.clearOverlays(),t.centerAndZoom("中国",5),t.enableScrollWheelZoom(),t.setMapStyle({style:"bluish"});var o=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT}),n=new BMap.NavigationControl,i=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});points=[],$.each(TempMacsArray,function(e,o){if(o===a){var n=[];$.each(MacsDataArray[e],function(a,o){var i=new BMap.Point(o.longitude,o.latitude);i.content="<div>MAC："+o.mac+"</div><div>时间："+moment(o.date).format("YYYY-MM-DD HH:mm:ss")+"</div>",n.push(i),points.push(i);new BMap.Marker(i);if(0==a){var r=new BMap.Marker(i,{icon:startIcon});t.addOverlay(r)}else if(a==MacsDataArray[e].length-1){var s=new BMap.Marker(i,{icon:endIcon});t.addOverlay(s)}});var i=new BMap.Polyline(n,{strokeColor:colorPalette[e],strokeWeight:4,strokeOpacity:.8});t.addOverlay(i)}});var r=new BMap.PointCollection(points,options);r.addEventListener("mouseover",function(a){e("",a)}),t.addOverlay(r),t.addControl(o),t.addControl(n),t.addControl(i)}$("#BDMapRight .panel-heading").click(function(){$("#BDMapRightBody").is(":hidden")?$("#BDMapRightIco").removeClass("icon-angle-down").addClass("icon-angle-up"):$("#BDMapRightIco").removeClass("icon-angle-up").addClass("icon-angle-down"),$("#BDMapRightBody").toggle(200)}),$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())});var colorPalette=["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],startIcon=new BMap.Icon("img/dest_markers.png",new BMap.Size(30,35),{offset:new BMap.Size(10,35),imageOffset:new BMap.Size(0,0)}),endIcon=new BMap.Icon("img/dest_markers.png",new BMap.Size(30,35),{offset:new BMap.Size(10,35),imageOffset:new BMap.Size(0,-35)}),MacsArray=[],MacsDataArray=[],TempMacsArray=[],points=[],options={size:BMAP_POINT_SIZE_SMALL,shape:BMAP_POINT_SHAPE_STAR,color:"#d340c3"},opts={height:80,enableMessage:!0};GetBaiDu()</script></body></html>