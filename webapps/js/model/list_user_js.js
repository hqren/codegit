function user_js_edit(id){var data="";data="id="+id,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"system/role/queryRoleAndAuthForUpdate.action",dataType:"json",data:data,success:function(jsonResult){var roleName=jsonResult.role.roleName,roleDesc=jsonResult.role.roleDesc,ListAuthArray=new Array;$.each(jsonResult.ListAuth,function(e,t){null!=t&&ListAuthArray.push(t.id)});var strHtml="";strHtml+='<div class="row"><div class="col-sm-12"><form id="FormValidator"  class="form-horizontal">',strHtml+='<br><div class="form-group"><label class="col-sm-3 control-label">\u540d\u79f0</label><div class="col-sm-6"><input type="text" id="roleName" name="roleName" class="form-control" value="'+roleName+'" placeholder="\u8f93\u5165\u89d2\u8272\u540d" maxlength="20"></div></div>',strHtml+='<div class="form-group"><label class="col-sm-3 control-label">\u63cf\u8ff0</label><div class="col-sm-6"><input type="text" id="roleDesc" name="roleDesc" class="form-control" value="'+roleDesc+'" placeholder="\u8f93\u5165\u89d2\u8272\u63cf\u8ff0"></div></div>',strHtml+='<div class="form-group"><label class="col-sm-3 control-label">\u6743\u9650\u8303\u56f4</label><div class="col-sm-6"><ul id="treeDemo" class="ztree"></ul></div></div>',strHtml+="</form></div></div>",BootstrapDialog.show({title:"\u4fee\u6539\u89d2\u8272",message:strHtml,onshown:function(dialogRef){$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"system/auth/queryAllAtuh.action",dataType:"json",success:function(jsonResult){var setting={check:{enable:!0},data:{simpleData:{enable:!0}}},DataArray=new Array;for(var key in jsonResult)DataArray.push(key);var treeNodeArray=new Array,treeNodeObject=new Object;treeNodeObject.id=0,treeNodeObject.name="\u5168\u90e8",treeNodeObject.open=!0,treeNodeArray.push(treeNodeObject);var Title,TempID;$.each(DataArray,function(e,t){"listTrain"==t?(Title="\u94c1\u8def",TempID=99991):"listBus"==t&&(Title="\u5927\u5df4",TempID=99992);var a=new Object;a.id=TempID,a.pId=0,a.name=Title,a.open=!0,treeNodeArray.push(a),$.each(jsonResult[t],function(e,t){var a=new Object;a.id=t.id,-1==t.parentId?(a.pId=TempID,console.log):a.pId=t.parentId,a.name=t.funcName,treeNodeArray.push(a)})});var zNodes=eval(treeNodeArray);if($.fn.zTree.init($("#treeDemo"),setting,zNodes),ListAuthArray.length>0){var zTree=$.fn.zTree.getZTreeObj("treeDemo");$.each(ListAuthArray,function(e,t){zTree.checkNode(zTree.getNodeByParam("id",t),!0)})}$("#FormValidator").bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{roleName:{message:"\u89d2\u8272\u540d\u79f0\u65e0\u6548",validators:{notEmpty:{message:"\u89d2\u8272\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"}}},roleDesc:{message:"\u89d2\u8272\u63cf\u8ff0\u65e0\u6548",validators:{notEmpty:{message:"\u89d2\u8272\u63cf\u8ff0\u4e0d\u80fd\u4e3a\u7a7a"}}}}})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u89d2\u8272\u4fe1\u606f\uff01")}})},buttons:[{label:"\u63d0\u4ea4",cssClass:"btn-primary",action:function(e){if($("#FormValidator").bootstrapValidator("validate"),$("#FormValidator").data("bootstrapValidator").isValid()){var t=$.fn.zTree.getZTreeObj("treeDemo"),a=t.getCheckedNodes(),o=new Array;$.each(a,function(e,t){o.push(t.id)}),o.remove(0),o.remove(99991),o.remove(99992);var r="";r="id="+id+"&roleName="+$("#roleName").val()+"&roleDesc="+$("#roleDesc").val()+"&authIds="+String(o),$.ajax({type:"post",url:"system/role/updateRoleAndAuth.action",timeout:6e4,dataType:"json",data:r,success:function(t){var a="";a=600009==t.result?t.message:ConfigCN[t.result],600005==t.result&&($("#table-user_js").bootstrapTable("refresh"),e.close()),BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:a,buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})},error:function(e,t,a){"timeout"==t&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else BootstrapDialog.alert({title:"\u9a8c\u8bc1\u5931\u8d25",message:"\u8bf7\u786e\u8ba4\u8f93\u5165\u5185\u5bb9\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff01",type:BootstrapDialog.TYPE_DANGER,buttonLabel:"\u786e\u8ba4"})}},{label:"\u91cd\u7f6e",action:function(e){$("#FormValidator").data("bootstrapValidator").resetForm(!0);$.fn.zTree.getZTreeObj("treeDemo").checkAllNodes(!1)}},{label:"\u5173\u95ed",action:function(e){e.close()}}]})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u89d2\u8272\u4fe1\u606f\uff01")}})}function user_js_delOne(e){BootstrapDialog.confirm({title:"\u5220\u9664\u786e\u8ba4\u63d0\u9192",message:"\u662f\u5426\u786e\u8ba4\u5220\u9664\u6240\u9009\u62e9\u89d2\u8272\uff1f",closable:!0,draggable:!0,btnCancelLabel:"\u53d6\u6d88",btnOKLabel:"\u786e\u8ba4",callback:function(t){if(t){var a="";a="id="+e,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"system/role/deleteSystemRoleById.action",timeout:6e4,dataType:"json",data:a,success:function(e){var t="";return t=600009==e.result?e.message:ConfigCN[e.result],600002!=e.result?(BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:t,buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]}),!1):($("#table-user_js").bootstrapTable("refresh"),void BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:t,buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]}))},error:function(e,t,a){"timeout"==t&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}}})}function queryParams_user_js(e){var t={limit:e.limit,offset:e.offset,roleName:$("#serach_roleName").val()};return t}var $table=$("#table-user_js");$table.bootstrapTable({method:"post",contentType:"application/x-www-form-urlencoded",url:"system/role/queryRoleByPage.action",dataType:"json",striped:!0,toolbar:"#toolbar",uniqueId:"trainLineId",pagination:!0,singleSelect:!1,idField:"trainLineId",sortable:!1,sidePagination:"server",queryParams:queryParams_user_js,columns:[{title:"\u5e8f\u53f7",field:"id",align:"center",valign:"middle",formatter:function(e,t,a){return a+1}},{title:"\u540d\u79f0",field:"roleName",align:"center",valign:"middle"},{title:"\u89d2\u8272\u63cf\u8ff0",field:"roleDesc",align:"center",valign:"middle"},{title:"\u64cd\u4f5c",field:"cz",align:"center",valign:"middle",formatter:function(e,t,a){var o='<button class="btn btn-primary" type="submit" onclick="user_js_edit('+t.id+');">\u4fee\u6539</button> <button class="btn btn-primary" type="submit" onclick="user_js_delOne('+t.id+');">\u5220\u9664</button>';return o}}]}),$("#user_js_add").click(function(){var strHtml="";strHtml+='<div class="row"><div class="col-sm-12"><form id="FormValidator"  class="form-horizontal">',strHtml+='<br><div class="form-group"><label class="col-sm-3 control-label">\u540d\u79f0</label><div class="col-sm-6"><input type="text" id="roleName" name="roleName" class="form-control" placeholder="\u8f93\u5165\u89d2\u8272\u540d" maxlength="20"></div></div>',strHtml+='<div class="form-group"><label class="col-sm-3 control-label">\u63cf\u8ff0</label><div class="col-sm-6"><input type="text" id="roleDesc" name="roleDesc" class="form-control" placeholder="\u8f93\u5165\u89d2\u8272\u63cf\u8ff0"></div></div>',strHtml+='<div class="form-group"><label class="col-sm-3 control-label">\u6743\u9650\u8303\u56f4</label><div class="col-sm-6"><ul id="treeDemo" class="ztree"></ul></div></div>',strHtml+="</form></div></div>",BootstrapDialog.show({title:"\u6dfb\u52a0\u89d2\u8272",message:strHtml,onshown:function(dialogRef){$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"system/auth/queryAllAtuh.action",dataType:"json",success:function(jsonResult){var setting={check:{enable:!0},data:{simpleData:{enable:!0}}},DataArray=new Array;for(var key in jsonResult)DataArray.push(key);var treeNodeArray=new Array,treeNodeObject=new Object;treeNodeObject.id=0,treeNodeObject.name="\u5168\u90e8",treeNodeObject.open=!0,treeNodeArray.push(treeNodeObject);var Title,TempID;$.each(DataArray,function(e,t){"listTrain"==t?(Title="\u94c1\u8def",TempID=99991):"listBus"==t&&(Title="\u5927\u5df4",TempID=99992);var a=new Object;a.id=TempID,a.pId=0,a.name=Title,a.open=!0,treeNodeArray.push(a),$.each(jsonResult[t],function(e,t){var a=new Object;a.id=t.id,-1==t.parentId?a.pId=TempID:a.pId=t.parentId,a.name=t.funcName,treeNodeArray.push(a)})});var zNodes=eval(treeNodeArray);$.fn.zTree.init($("#treeDemo"),setting,zNodes),$("#FormValidator").bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{roleName:{message:"\u89d2\u8272\u540d\u79f0\u65e0\u6548",validators:{notEmpty:{message:"\u89d2\u8272\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"},threshold:6,remote:{url:"system/user/checkUserByRoleName.action",message:"\u89d2\u8272\u540d\u79f0\u5df2\u5b58\u5728\uff01",delay:1e3,type:"POST",data:function(e){return{roleName:$("#roleName").val()}}}}},roleDesc:{message:"\u89d2\u8272\u63cf\u8ff0\u65e0\u6548",validators:{notEmpty:{message:"\u89d2\u8272\u63cf\u8ff0\u4e0d\u80fd\u4e3a\u7a7a"}}}}})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u89d2\u8272\u4fe1\u606f\uff01")}})},buttons:[{label:"\u63d0\u4ea4",cssClass:"btn-primary",action:function(e){if($("#FormValidator").bootstrapValidator("validate"),$("#FormValidator").data("bootstrapValidator").isValid()){var t=$.fn.zTree.getZTreeObj("treeDemo"),a=t.getCheckedNodes(),o=new Array;$.each(a,function(e,t){o.push(t.id)}),o.remove(0),o.remove(99991),o.remove(99992);var r="";r="roleName="+$("#roleName").val()+"&roleDesc="+$("#roleDesc").val()+"&authIds="+String(o),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"system/role/addSystemRole.action",timeout:6e4,dataType:"json",data:r,success:function(t){var a="";a=600009==t.result?t.message:ConfigCN[t.result],6e5==t.result&&($("#table-user_js").bootstrapTable("refresh"),e.close()),BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:a,buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})},error:function(e,t,a){"timeout"==t&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else BootstrapDialog.alert({title:"\u9a8c\u8bc1\u5931\u8d25",message:"\u8bf7\u786e\u8ba4\u8f93\u5165\u5185\u5bb9\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff01",type:BootstrapDialog.TYPE_DANGER,buttonLabel:"\u786e\u8ba4"})}},{label:"\u91cd\u7f6e",action:function(e){$("#FormValidator").data("bootstrapValidator").resetForm(!0);$.fn.zTree.getZTreeObj("treeDemo").checkAllNodes(!1)}},{label:"\u5173\u95ed",action:function(e){e.close()}}]})}),$("#serach_button").click(function(){$("#table-user_js").bootstrapTable("refresh")});