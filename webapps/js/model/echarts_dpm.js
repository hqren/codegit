function getStatisticsDevice(){$.ajax({type:"post",url:"screenapi/getStatisticsDevice.action",timeout:6e4,dataType:"json",success:function(e){trainStatDevToday=e.trainStatDevToday,busStatDevToday=e.busStatDevToday,echarts1(),echarts4()},error:function(e,t,a){"timeout"==t&&console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}})}function getVStatUser(){$.ajax({type:"post",url:"screenapi/getVStatUser.action",timeout:6e4,dataType:"json",success:function(e){var t=new Date;trainSum=e.trainSum,busSum=e.busSum,trainUser=e.trainUser,busUser=e.busUser,$("#yesterdayPV_3").html(trainUser.yesterdayPV.toLocaleString()),$("#yesterdayUV_3").html(trainUser.yesterdayUV.toLocaleString()),$("#yesterdayAddUV_3").html(trainUser.yesterdayAddUV.toLocaleString()),$("#yesterdayTime_3").html(trainUser.yesterdayTime+"min"),$("#yesterdayPV_6").html(busUser.yesterdayPV.toLocaleString()),$("#yesterdayUV_6").html(busUser.yesterdayUV.toLocaleString()),$("#yesterdayAddUV_6").html(busUser.yesterdayAddUV.toLocaleString()),$("#yesterdayTime_6").html(busUser.yesterdayTime+"min"),todayUserCount_3=trainUser.todayUserCount.split("#"),todayUserCount_3=todayUserCount_3.slice(0,t.getHours()),yestodayUserCount_3=trainUser.yestodayUserCount.split("#"),weekUserCount_3=trainUser.weekUserCount.split("#"),todayUserCount_6=busUser.todayUserCount.split("#"),todayUserCount_6=todayUserCount_6.slice(0,t.getHours()),yestodayUserCount_6=busUser.yestodayUserCount.split("#"),weekUserCount_6=busUser.weekUserCount.split("#"),echarts3(),echarts6()},error:function(e,t,a){"timeout"==t&&console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}})}function echarts1(){var e=trainStatDevToday.sum,t=echarts.init(document.getElementById("echarts_1"),"macarons");option1={tooltip:{axisPointer:{type:"none"}},toolbox:{show:!1},grid:{left:"0%",right:"0%",bottom:"80px"},xAxis:[{show:!1,type:"category"}],yAxis:[{show:!1,type:"value"}],series:[{show:!1,name:"\u8bbe\u5907\u603b\u6570",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[0],barBorderRadius:0}},barGap:"130%",data:[trainStatDevToday.sum]},{show:!1,name:"\u7d2f\u8ba1\u5728\u7ebf",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[1],barBorderRadius:0}},barGap:"130%",data:[trainStatDevToday.sumOnline]},{show:!1,name:"\u4eca\u65e5\u5728\u7ebf",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[2],barBorderRadius:0}},barGap:"130%",data:[trainStatDevToday.sumTodayOnline]},{show:!1,name:"\u4eca\u65e5\u6d3b\u8dc3",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[3],barBorderRadius:0}},barGap:"130%",data:[trainStatDevToday.sumTodayActive]}]},t.setOption(option1)}function echarts3(){for(var e=new Array,t=0;24>t;t++)e.push(t+":00");var a=echarts.init(document.getElementById("echarts_3_min"),"macarons");option3={legend:{textStyle:{color:"#65d2ff"},icon:"line",data:["\u4eca\u65e5\u7528\u6237\u6570","\u6628\u65e5\u7528\u6237\u6570","\u4e0a\u5468\u5468\u671f\u7528\u6237\u6570"]},tooltip:{axisPointer:{type:"none"}},toolbox:{show:!0},grid:{top:"30px",left:"60px",right:"20px",bottom:"40px"},xAxis:{type:"category",boundaryGap:!1,axisLabel:{show:!0,interval:0,rotate:60,textStyle:{color:"#65d2ff"}},splitLine:{show:!1},data:e},yAxis:{show:TempYAxis3Show,type:"value",axisLabel:{show:!0,textStyle:{color:"#65d2ff"}},splitLine:{show:!1},splitArea:{show:!1}},series:[{name:"\u4eca\u65e5\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#29b969"}},data:todayUserCount_3},{name:"\u6628\u65e5\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#7f53c5"}},data:yestodayUserCount_3},{name:"\u4e0a\u5468\u5468\u671f\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#f8b526"}},data:weekUserCount_3}]},a.setOption(option3)}function echarts2(){var e=1e3,t=new Map,a=[],n=echarts.init(document.getElementById("echarts_2"));$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"GPS/getRealTimeGPS.action?car_type=1&time="+e,dataType:"json",success:function(o){$.each(o,function(e,n){var o=n.lonLat.split(",");t.put({name:n.mac,value:15}),a[n.mac]=o}),t=t.keys();var r=function(e){for(var t=[],n=0;n<e.length;n++){var o=a[e[n].name];o&&t.push({name:e[n].name,value:o.concat(e[n].value)})}return t};option2={tooltip:{show:!1,trigger:"item"},geo:{map:"china",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#12151b",borderColor:"#ff9527"},emphasis:{areaColor:"#2a333d"}}},series:[{name:"\u706b\u8f66",type:"scatter",coordinateSystem:"geo",data:r(t),symbolSize:function(e){return e[2]/10},label:{normal:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!0}},itemStyle:{normal:{color:"#ff9527"}}},{name:"Top 5",type:"effectScatter",coordinateSystem:"geo",data:getArrayItems(r(t),100),symbolSize:function(e){return e[2]/5},showEffectOn:"render",rippleEffect:{brushType:"stroke"},hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"right",show:!1}},itemStyle:{normal:{color:"#ff7d27",shadowBlur:10,shadowColor:"#333"}},zlevel:1}]};var s=parseInt(t.length/100);t.length%100!=0&&(s+=1);var i=0;IntervalId2=window.setInterval(function(){s>i?(option2.series[1].data=getArrayItems2(r(t),i,100),n.setOption(option2),i++):(i=0,t=new Map,a=[],$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"GPS/getRealTimeGPS.action?car_type=1&time="+e,dataType:"json",success:function(e){$.each(e,function(e,n){var o=n.lonLat.split(",");t.put({name:n.mac,value:15}),a[n.mac]=o}),t=t.keys();var o=function(e){for(var t=[],n=0;n<e.length;n++){var o=a[e[n].name];o&&t.push({name:e[n].name,value:o.concat(e[n].value)})}return t};s=parseInt(t.length/100),option2.series[0].data=o(t),option2.series[1].data=getArrayItems2(o(t),i,100),n.setOption(option2)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}}))},5e3),n.setOption(option2)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}})}function echarts4(){var e=busStatDevToday.sum,t=echarts.init(document.getElementById("echarts_4"),"macarons");option4={tooltip:{axisPointer:{type:"none"}},toolbox:{show:!1},grid:{left:"0%",right:"0%",bottom:"80px"},xAxis:[{show:!1,type:"category"}],yAxis:[{show:!1,type:"value"}],series:[{show:!1,name:"\u8bbe\u5907\u603b\u6570",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(e,t,a){return"All"==Type?"\n"+e.data.toLocaleString()+"\n\n"+e.seriesName:"\n\n\n"+e.seriesName}}},itemStyle:{normal:{color:colors[0],barBorderRadius:0}},barGap:"130%",data:[busStatDevToday.sum]},{show:!1,name:"\u7d2f\u8ba1\u5728\u7ebf",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[1],barBorderRadius:0}},barGap:"130%",data:[busStatDevToday.sumOnline]},{show:!1,name:"\u4eca\u65e5\u5728\u7ebf",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[2],barBorderRadius:0}},barGap:"130%",data:[busStatDevToday.sumTodayOnline]},{show:!1,name:"\u4eca\u65e5\u6d3b\u8dc3",type:"bar",label:{normal:{show:!0,position:"bottom",textStyle:{fontSize:14},formatter:function(t,a,n){return"All"==Type?"\n"+t.data.toLocaleString()+"\n\n"+t.seriesName:0!=t.data?"\n"+(t.data/e*100).toFixed(2).toLocaleString()+"%\n\n"+t.seriesName:"\n0%\n\n"+t.seriesName}}},itemStyle:{normal:{color:colors[3],barBorderRadius:0}},barGap:"130%",data:[busStatDevToday.sumTodayActive]}]},t.setOption(option4)}function echarts6(){for(var e=new Array,t=0;24>t;t++)e.push(t+":00");var a=echarts.init(document.getElementById("echarts_6_min"),"macarons");option6={legend:{textStyle:{color:"#65d2ff"},icon:"line",data:["\u4eca\u65e5\u7528\u6237\u6570","\u6628\u65e5\u7528\u6237\u6570","\u4e0a\u5468\u5468\u671f\u7528\u6237\u6570"]},tooltip:{axisPointer:{type:"none"}},toolbox:{show:!0},grid:{top:"30px",left:"60px",right:"20px",bottom:"40px"},xAxis:{type:"category",boundaryGap:!1,axisLabel:{show:!0,interval:0,rotate:60,textStyle:{color:"#65d2ff"}},splitLine:{show:!1},data:e},yAxis:{show:TempYAxis6Show,type:"value",axisLabel:{show:!0,textStyle:{color:"#65d2ff"}},splitLine:{show:!1},splitArea:{show:!1}},series:[{name:"\u4eca\u65e5\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#29b969"}},data:todayUserCount_6},{name:"\u6628\u65e5\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#7f53c5"}},data:yestodayUserCount_6},{name:"\u4e0a\u5468\u5468\u671f\u7528\u6237\u6570",type:"line",itemStyle:{normal:{color:"#f8b526"}},data:weekUserCount_6}]},a.setOption(option6)}function echarts5(){var e=1e3,t=new Map,a=[],n=echarts.init(document.getElementById("echarts_5"));$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"GPS/getRealTimeGPS.action?car_type=2&time="+e,dataType:"json",success:function(o){$.each(o,function(e,n){var o=n.lonLat.split(",");t.put({name:n.mac,value:15}),a[n.mac]=o}),t=t.keys();var r=function(e){for(var t=[],n=0;n<e.length;n++){var o=a[e[n].name];o&&t.push({name:e[n].name,value:o.concat(e[n].value)})}return t};option5={tooltip:{show:!1,trigger:"item"},geo:{map:"china",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#12151b",borderColor:"#369cf4"},emphasis:{areaColor:"#2a333d"}}},series:[{name:"\u5927\u5df4",type:"scatter",coordinateSystem:"geo",data:r(t),symbolSize:function(e){return e[2]/10},label:{normal:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!0}},itemStyle:{normal:{color:"#369cf4"}}},{name:"Top 5",type:"effectScatter",coordinateSystem:"geo",data:getArrayItems(r(t),100),symbolSize:function(e){return e[2]/5},showEffectOn:"render",rippleEffect:{brushType:"stroke"},hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"right",show:!1}},itemStyle:{normal:{color:"#369cf4",shadowBlur:10,shadowColor:"#333"}},zlevel:1}]};var s=parseInt(t.length/100);t.length%100!=0&&(s+=1);var i=0;IntervalId5=window.setInterval(function(){s>i?(option5.series[1].data=getArrayItems2(r(t),i,100),n.setOption(option5),i++):(i=0,t=new Map,a=[],$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"GPS/getRealTimeGPS.action?car_type=2&time="+e,dataType:"json",success:function(e){$.each(e,function(e,n){var o=n.lonLat.split(",");t.put({name:n.mac,value:15}),a[n.mac]=o}),t=t.keys();var o=function(e){for(var t=[],n=0;n<e.length;n++){var o=a[e[n].name];o&&t.push({name:e[n].name,value:o.concat(e[n].value)})}return t};s=parseInt(t.length/100),option5.series[0].data=o(t),option5.series[1].data=getArrayItems2(o(t),i,100),n.setOption(option5)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}}))},5e3),n.setOption(option5)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}})}function getdata(e){3==e?0!=trainSumNew?show_num(trainSumNew,e):show_num(trainSum,e):6==e?0!=trainSumNew?show_num(busSumNew,e):show_num(busSum,e):show_num(TempNum,e)}function getRandom(e){return Math.floor(Math.random()*e+1)}function show_num(e,t){e=parseInt(e).toLocaleString();for(var a=$("#echarts_"+t+" .t_num i"),n=String(e).length,o=0;n>o;o++){a.length<=o&&$("#echarts_"+t+" .t_num").append("<i></i>");var r=String(e).charAt(o);if(","!=r){var s=23*-parseInt(r),i=$("#echarts_"+t+" .t_num i").eq(o);i.animate({backgroundPosition:"(0 "+String(s)+"px)"},"slow","swing",function(){})}else{var s=23*-parseInt(11),i=$("#echarts_"+t+" .t_num i").eq(o);i.animate({backgroundPosition:"(0 "+String(s)+"px)"},"slow","swing",function(){})}}}function Map(){this.elements=new Array,this.size=function(){return this.elements.length},this.isEmpty=function(){return this.elements.length<1},this.clear=function(){this.elements=new Array},this.put=function(e,t){this.elements.push({key:e,value:t})},this.remove=function(e){var t=!1;try{for(i=0;i<this.elements.length;i++)if(this.elements[i].key==e)return this.elements.splice(i,1),!0}catch(a){t=!1}return t},this.get=function(e){try{for(i=0;i<this.elements.length;i++)if(this.elements[i].key==e)return this.elements[i].value}catch(t){return null}},this.element=function(e){return 0>e||e>=this.elements.length?null:this.elements[e]},this.containsKey=function(e){var t=!1;try{for(i=0;i<this.elements.length;i++)this.elements[i].key==e&&(t=!0)}catch(a){t=!1}return t},this.containsValue=function(e){var t=!1;try{for(i=0;i<this.elements.length;i++)this.elements[i].value==e&&(t=!0)}catch(a){t=!1}return t},this.values=function(){var e=new Array;for(i=0;i<this.elements.length;i++)e.push(this.elements[i].value);return e},this.keys=function(){var e=new Array;for(i=0;i<this.elements.length;i++)e.push(this.elements[i].key);return e}}function getArrayItems2(e,t,a){var n=new Array;return n=e.slice(t*a,t*a+a)}function getArrayItems(e,t){var a=new Array;for(var n in e)a.push(e[n]);for(var o=new Array,r=0;t>r&&a.length>0;r++){var s=Math.floor(Math.random()*a.length);o[r]=a[s],a.splice(s,1)}return o}function getUrlParam(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}var Type=getUrlParam("Type"),TempYAxis3Show=!0,TempYAxis6Show=!0;"All"!=Type&&(Type="");var WebWidth=$(window).width(),WebHeight=$(window).height();console.log(WebWidth);var TempEcharts3Height=27;WebWidth>=1024&&1920>WebWidth?600>WebHeight?TempEcharts3Height=12:700>WebHeight?TempEcharts3Height=17:800>WebHeight?TempEcharts3Height=19:900>WebHeight&&(TempEcharts3Height=24):WebWidth>=1920&&(TempEcharts3Height=30),""==Type&&(TempEcharts3Height+=3,TempYAxis3Show=!1,TempYAxis6Show=!1),TempEcharts3Height+="rem";var TempNum=5e6;$("#main_dpm").css({width:WebWidth,height:WebHeight});for(var Titles=["\u94c1\u8def\u8bbe\u5907\u6570\u636e","\u94c1\u8def\u8bbe\u5907\u5b9e\u65f6\u4f4d\u7f6e\u56fe","\u94c1\u8def\u7528\u6237\u6570\u636e","\u5927\u5df4\u8bbe\u5907\u6570\u636e","\u5927\u5df4\u8bbe\u5907\u5b9e\u65f6\u4f4d\u7f6e\u56fe","\u5927\u5df4\u7528\u6237\u6570\u636e"],colors=["#18b5f9","#ffb400","#29b969","#9959b3"],strHtml="",i=0;6>i;i++){var left0="";2!=i&&5!=i||(left0=" left0"),strHtml+='<div class="echartsDiv"><div class="echartsTitle'+left0+'">'+Titles[i]+'</div><div id="echarts_'+parseInt(i+1)+'" style="width:'+WebWidth/3+"px;height:"+WebHeight/2+'px"></div></div>'}$("#main_dpm").html(strHtml);var strHtml="",strTool="";strTool+='<li><h5>\u4eca\u65e5\u603bPV</h5><span id="yesterdayPV_3"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li><h5>\u4eca\u65e5\u7528\u6237\u6570</h5><span id="yesterdayUV_3"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li style="display:none;"><h5>\u4eca\u65e5\u65b0\u7528\u6237</h5><span id="yesterdayAddUV_3"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li><h5>\u5e73\u5747\u505c\u7559\u65f6\u957f</h5><span id="yesterdayTime_3"><i class="fa fa-spinner fa-spin"></i></span></li>',strHtml+="All"==Type?'<div class="TrainUserCount"><span  class="t_num"></span></div><div class="Tool"><ul>'+strTool+'</ul></div><div id="echarts_3_min" style="width:'+WebWidth/3+"px;height:"+TempEcharts3Height+'"></div>':'<div class="TrainUserCount"><span  class="t_num"></span></div><div id="echarts_3_min" style="top:70px; width:'+WebWidth/3+"px;height:"+TempEcharts3Height+'"></div>',$("#echarts_3").html(strHtml);var strHtml="",strTool="";strTool+='<li><h5>\u4eca\u65e5\u603bPV</h5><span id="yesterdayPV_6"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li><h5>\u4eca\u65e5\u7528\u6237\u6570</h5><span id="yesterdayUV_6"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li style="display:none;"><h5>\u4eca\u65e5\u65b0\u7528\u6237</h5><span id="yesterdayAddUV_6"><i class="fa fa-spinner fa-spin"></i></span></li>',strTool+='<li><h5>\u5e73\u5747\u505c\u7559\u65f6\u957f</h5><span id="yesterdayTime_6"><i class="fa fa-spinner fa-spin"></i></span></li>',strHtml+="All"==Type?'<div class="TrainUserCount"><span class="t_num"></span></div><div class="Tool"><ul>'+strTool+'</ul></div><div id="echarts_6_min" style="width:'+WebWidth/3+"px;height:"+TempEcharts3Height+'"></div>':'<div class="TrainUserCount"><span  class="t_num"></span></div><div id="echarts_6_min" style="top:70px; width:'+WebWidth/3+"px;height:"+TempEcharts3Height+'"></div>',$("#echarts_6").html(strHtml);var trainSum=0,busSum=0,trainSumNew=0,busSumNew=0,trainStatDevToday,busStatDevToday,trainUser,busUser,todayUserCount_3,yestodayUserCount_3,weekUserCount_3,todayUserCount_6,yestodayUserCount_6,weekUserCount_6,IntervalId1,IntervalId2,IntervalId3,IntervalId4,IntervalId5,IntervalId6;getStatisticsDevice(),getVStatUser();var IntervalIdDefault=window.setInterval(function(){getStatisticsDevice(),getVStatUser()},18e5);echarts2(),echarts5();