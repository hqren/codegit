function DevByUser(){var data="";data="car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/queryDevByUser.action",dataType:"json",data:data,success:function(jsonResult){var setting={view:{fontCss:getFont,nameIsHTML:!0},check:{enable:!0},data:{simpleData:{enable:!0}},callback:{beforeClick:beforeClick}},treeNodeArray=new Array,treeNodeObject=new Object;treeNodeObject.id=0,treeNodeObject.name="\u5168\u90e8",treeNodeObject.open=!0,treeNodeArray.push(treeNodeObject),$.each(jsonResult,function(e,a){var t=new Object;if(t.id=a.id,t.pId=0,t.name=a.mac,1==a.devStatus){new Object;t.font={color:"red"}}t.devStatus=a.devStatus,treeNodeArray.push(t)});var zNodes=eval(treeNodeArray);$.fn.zTree.init($("#treeDemo"),setting,zNodes)},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u5e38\u7528\u8bbe\u5907\uff01")}})}function CommandByUser(){var e="";e="car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/queryCommandByUser.action",dataType:"json",data:e,success:function(e){$("#CommandByUser").html(""),$.each(e,function(e,a){$("#CommandByUser").append('<a href="javascript:void(0);" class="list-group-item">'+a.command+"</a>")}),$("#CommandByUser a").click(function(){$("#CommandByUser a").removeClass("active"),$(this).addClass("active"),$("#data").val($(this).text()),TempCommand=$(this).text(),$("#CommandByUser_Del").removeClass("disabled"),$("#CommandByUser_Del").prop("disabled",!1),$("#SSHReturn").removeClass("disabled"),$("#SSHReturn").prop("disabled",!1)})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u5e38\u7528\u547d\u4ee4\uff01")}})}function beforeClick(e,a,t){$.each(IntervalArray,function(e,a){clearInterval(a)}),IntervalArray=new Array,$("#log").html(""),TempMac=a.name,TempDevStatus=a.devStatus;var o="";o="mac="+TempMac,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/getExecDevJobHistory.action",dataType:"json",data:o,success:function(e){var a="";$.each(e,function(e,t){a+="<li><br>"+t.updateTime+" "+t.cmd+"</li>",a+="<li>"+t.finishTime+"</li>",a+="<li>"+HTMLEncode(t.remarks).replace(/\u0001/g,"<br>")+"<br>=*= END =*=<br><br></li>"}),$("#log").html(a)},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u8bbe\u5907\u5386\u53f2\u8bb0\u5f55\uff01")}}),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"device/getClientLogsToday.action",dataType:"json",data:o,success:function(e){var a="";$.each(e,function(e,t){a+="<li><br>"+t.finishTime+" "+t.msg+"</li>"}),$("#log2").html(a)},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u8bbe\u5907\u65e5\u5fd7\uff01")}})}function getFont(e,a){return a.font?a.font:{}}var TempCommand="",TempMac="",TempDevStatus="",IntervalArray=new Array;DevByUser(),CommandByUser(),$("#Mac_Add").click(function(){if($("#FormValidator_Mac").bootstrapValidator("validate"),$("#FormValidator_Mac").data("bootstrapValidator").isValid()){var e="";e="mac="+$("#Mac").val()+"&car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/addUserDev.action",timeout:6e4,dataType:"json",data:e,success:function(e){var a="";a=600009==e.result?e.message:ConfigCN[e.result],6e5==e.result&&DevByUser(),errorNotify(null,a)},error:function(e,a,t){"timeout"==a&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else errorNotify(null,"\u8bf7\u8f93\u5165\u8bbe\u5907MAC\uff01")}),$("#Mac_Del").click(function(){var e=$.fn.zTree.getZTreeObj("treeDemo"),a=e.getCheckedNodes(),t=new Array;if($.each(a,function(e,a){void 0==a.children&&t.push(a.name)}),t.length>0){var o="";o="mac="+String(t),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/delUserDev.action",timeout:6e4,dataType:"json",data:o,success:function(e){var a="";a=600009==e.result?e.message:ConfigCN[e.result],600002==e.result&&DevByUser(),errorNotify(null,a)},error:function(e,a,t){"timeout"==a&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else errorNotify(null,"\u8bf7\u9009\u62e9\u9700\u8981\u5220\u9664\u7684\u8bbe\u5907MAC\uff01")}),$("#CommandByUser_Add").click(function(){if($("#FormValidator_CommandByUser").bootstrapValidator("validate"),$("#FormValidator_CommandByUser").data("bootstrapValidator").isValid()){var e="";e="command="+encodeURIComponent($("#CommandByUser_Text").val()),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/addUserCommand.action",timeout:6e4,dataType:"json",data:e,success:function(e){var a="";a=600009==e.result?e.message:ConfigCN[e.result],6e5==e.result&&CommandByUser(),errorNotify(null,a)},error:function(e,a,t){"timeout"==a&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else errorNotify(null,"\u8bf7\u8f93\u5165\u547d\u4ee4\uff01")}),$("#CommandByUser_Del").click(function(){0!=$("#CommandByUser a").length&&""!=TempCommand?$("#CommandByUser a").each(function(e,a){if($(this).hasClass("active")){var t="";t="command="+encodeURIComponent(TempCommand),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/delUserCommand.action",timeout:6e4,dataType:"json",data:t,success:function(e){var a="";a=600009==e.result?e.message:ConfigCN[e.result],600002==e.result&&(CommandByUser(),TempCommand=""),errorNotify(null,a)},error:function(e,a,t){"timeout"==a&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}}):($("#CommandByUser_Del").addClass("disabled"),$("#CommandByUser_Del").prop("disabled",!0),errorNotify(null,"\u6682\u65e0\u53ef\u5220\u9664\u547d\u4ee4"))}),$("#SSHReturn").click(function(){if(""!=TempMac&&""!=$("#data").val()&&1==TempDevStatus){var e="",a=TempMac,t=encodeURIComponent($("#data").val());e="macs="+a+"&data="+t,$.ajax({type:"POST",url:"execJob/execDevJob.action",timeout:6e4,dataType:"json",data:e,success:function(o){if(0!=o.code)return errorNotify("\u9519\u8bef\uff1a",o.message,null),!1;errorNotify("\u6210\u529f\uff1a","\u547d\u4ee4\u6dfb\u52a0\u6210\u529f","success");var r=o.execJobId,n=o.updateTime;$("#SSHReturn").addClass("disabled"),$("#SSHReturn").prop("disabled",!0);var i="",l=function(){0==$("#log_"+s).length&&$("#log").prepend("<li>"+n+" "+HTMLEncode($("#data").val())+'</li><div id="log_'+s+'"><div class="load"><li><i class="fa fa-spinner fa-spin"></i> \u6b63\u5728\u6267\u884c...</li></div></div>'),e="mac="+a+"&data="+encodeURIComponent(t)+"&execJobId="+r+"&remarks="+i+"&intervalId="+s,$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"execJob/getExecDevJobResult.action",timeout:6e4,dataType:"json",data:e,success:function(e){if(null!=e&&("0"==e.result||"1"==e.result)){var a="";if($("#log_"+e.intervalId+" .load").remove(),clearInterval(e.intervalId),a+="<li>"+e.finishTime+"</li>",""!=e.remarks){var t=e.remarks.split(",");t.forEach(function(e){""!=e&&(e=HTMLEncode(e),a+="<li>"+e.replace(/\u0001/g,"<br>")+"</li>")}),a+="<li><br>=*= END =*=<br><br></li>"}else a+="<li><br>=*= END =*=<br><br></li>";return $("#log_"+s).html(a),!1}}})},s=setInterval(l,1e4);IntervalArray.push(s),l()},error:function(e,a,t){"timeout"==a&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(e){e.close()}}]})}})}else""==$("#data").val()?errorNotify(null,"\u547d\u4ee4\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u8f93\u5165\u547d\u4ee4\uff01"):1!=TempDevStatus&&""!=TempDevStatus?errorNotify(null,"\u8be5\u8bbe\u5907\u5904\u4e8e\u79bb\u7ebf\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0b\u53d1\u547d\u4ee4\uff01"):""==TempMac&&errorNotify(null,"\u8bf7\u5148\u5728\u5de6\u4fa7\u70b9\u51fb\u6307\u5b9aMAC\u540e\u518d\u70b9\u51fb\u6267\u884c\u6309\u94ae\uff01")}),$("#data").bind("input propertychange",function(){$("#SSHReturn").removeClass("disabled"),$("#SSHReturn").prop("disabled",!1)}),$("#FormValidator_Mac").bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{Mac:{message:"\u8bbe\u5907MAC\u65e0\u6548",validators:{notEmpty:{message:"\u8bbe\u5907MAC\u4e0d\u80fd\u4e3a\u7a7a"}}}}}),$("#FormValidator_CommandByUser").bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{CommandByUser_Text:{message:"\u547d\u4ee4\u65e0\u6548",validators:{notEmpty:{message:"\u547d\u4ee4\u4e0d\u80fd\u4e3a\u7a7a"}}}}});