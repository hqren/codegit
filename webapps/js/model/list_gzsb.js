function gzsb_read(a,l,e){var t="";t="workflowId="+a,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"deviceFaultInfo/getDetailByWorkFlow.action",dataType:"json",data:t,success:function(a){var t,s,o,i,c;i="";var r="";r+='<div class="row"><div class="col-sm-12"><div id="custom_gzsb" class="form-horizontal">',r+='<div class="form-group text-center"><h2>'+l+"</h2></div>",r+='<div class="custom_gzsb_form">',c=a.length,$.each(a,function(a,l){t=l.reportUserName,s=l.handleUserName,o=l.verifyUserName,0==a?(r+='<div class="form-group">',r+='<div class="col-sm-1 text-center"><br><br><br>\u7b2c'+parseInt(a+1)+"\u6b21</div>",r+='<div class="col-sm-2 text-center"><span class="oval">\u5f85\u5904\u7406</span><br>\u4e0a\u62a5\u4eba\uff1a'+l.reportUserName+"<br>"+l.reportTime+"</div>",r+='<div class="col-sm-1 custom_gzsb_line"><span>&nbsp;</span></div>',r+='<div class="col-sm-2 text-center"><span class="oval">\u5f85\u6838\u5b9e</span><br>\u5904\u7406\u4eba\uff1a'+l.handleUserName+"<br>"+l.handleTime+"</div>",r+='<div class="col-sm-1 custom_gzsb_line"><span>&nbsp;</span></div>',r+='<div class="col-sm-2 text-center"><span class="oval">\u5df2\u6838\u5b9e</span><br>\u6838\u5b9e\u4eba\uff1a'+l.verifyUserName+"<br>"+l.verifyTime+"</div>",r+='<div class="col-sm-1 custom_gzsb_line"><span>&nbsp;<b class="triangle-right">&nbsp;</b></span></div>',r+='<div class="col-sm-2 text-center"><span class="oval">\u5df2\u89e3\u51b3</span></div>',r+="</div>",i+=l.remark):(r+='<div class="form-group">',r+='<div class="col-sm-1 text-center"><br>\u7b2c'+parseInt(a+1)+"\u6b21</div>",r+='<div class="col-sm-2 text-center">'+l.reportUserName+"<br>"+l.reportTime+"</div>",r+='<div class="col-sm-1"></div>',r+='<div class="col-sm-2 text-center">'+l.handleUserName+"<br>"+l.handleTime+"</div>",r+='<div class="col-sm-1"></div>',r+='<div class="col-sm-2 text-center">'+l.verifyUserName+"<br>"+l.verifyTime+"</div>",r+='<div class="col-sm-1"></div>',r+='<div class="col-sm-2 text-center"></div>',r+="</div>",i+="<br>"+l.remark)}),r+="</div>",r+='<div class="col-sm-12 line-border-bottom"><label class="col-sm-2 control-label">\u6545\u969c\u539f\u56e0\uff1a</label><div class="col-sm-3"><p class="form-control-static">'+i+"</p></div></div>",r+="</div></div></div>";var n="";n="mac="+l,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"device/getDevInfo.action",dataType:"json",data:n,success:function(a){r+='<br><div class="row"><div class="col-sm-12"><div class="form-horizontal" id="FormValidator">',r+='<div class="form-group"><label class="col-sm-2 control-label">\u914d\u5c5e\u5c40</label><div class="col-sm-3"><p class="form-control-static">'+a.bureauName+'</p></div><label class="col-sm-2 control-label">\u8f66\u6b21</label><div class="col-sm-3"><p class="form-control-static">'+a.lineName+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u914d\u5c5e\u6bb5</label><div class="col-sm-3"><p class="form-control-static">'+a.stationName+'</p></div><label class="col-sm-2 control-label">\u7ec4\u522b</label><div class="col-sm-3"><p class="form-control-static">'+a.groupName+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u914d\u5c5e\u8f66\u95f4</label><div class="col-sm-3"><p class="form-control-static">'+a.shopName+'</p></div><label class="col-sm-2 control-label">\u59cb\u53d1\u7ec8\u70b9</label><div class="col-sm-3"><p class="form-control-static">'+a.startStation+"->"+a.endStation+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u5165\u5e93\u65f6\u95f4</label><div class="col-sm-3"><p class="form-control-static">'+a.inStorageTime+'</p></div><label class="col-sm-2 control-label">\u8f66\u578b</label><div class="col-sm-3"><p class="form-control-static">'+a.lineModel+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u51fa\u5e93\u65f6\u95f4</label><div class="col-sm-3"><p class="form-control-static">'+a.outStorageTime+'</p></div><label class="col-sm-2 control-label">\u8f66\u79cd</label><div class="col-sm-3"><p class="form-control-static">'+a.carriageType+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u8054\u901a\u5361</label><div class="col-sm-3"><p class="form-control-static">'+a.iccid1+'</p></div><label class="col-sm-2 control-label">\u8f66\u53f7</label><div class="col-sm-3"><p class="form-control-static">'+a.carriageName+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u7535\u4fe1\u5361</label><div class="col-sm-3"><p class="form-control-static">'+a.iccid2+'</p></div><label class="col-sm-2 control-label">\u8f66\u53a2\u53f7</label><div class="col-sm-3"><p class="form-control-static">'+a.carriageNo+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u8bbe\u5907\u72b6\u6001</label><div class="col-sm-3"><p class="form-control-static">'+devAssetsStatusCN(a.devAssetsStatus)+'</p></div><label class="col-sm-2 control-label">\u6545\u969c\u63cf\u8ff0</label><div class="col-sm-3"><p class="form-control-static">'+a.trobuleDesc+"</p></div></div>",r+='<div class="form-group"><label class="col-sm-2 control-label">\u5907\u6ce8</label><div class="col-sm-10"><p class="form-control-static">'+a.installDesc+"</p></div></div>",r+="</div></div></div>",BootstrapDialog.show({size:BootstrapDialog.SIZE_WIDE,title:"\u8be6\u60c5",message:r,onshown:function(a){"04"==e?($(".custom_gzsb_line:eq(0)").addClass("hover"),$(".custom_gzsb_line:eq(1)").addClass("hover"),$(".custom_gzsb_line:eq(2)").addClass("hover"),$(".oval:eq(0)").addClass("hover"),$(".oval:eq(1)").addClass("hover"),$(".oval:eq(2)").addClass("hover"),$(".oval:eq(3)").addClass("hover")):(""!=t&&$(".oval:eq(0)").addClass("hover"),""!=s&&($(".custom_gzsb_line:eq(0)").addClass("hover"),$(".oval:eq(1)").addClass("hover")),""!=o&&($(".custom_gzsb_line:eq(1)").addClass("hover"),$(".oval:eq(2)").addClass("hover")))},buttons:[{label:"\u5173\u95ed",action:function(a){a.close()}}]})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f\uff01")}})},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u4e0a\u62a5\u4fe1\u606f\uff01")}})}function gzsb_edit(a){var l="";l+='<div class="row"><div class="col-sm-12"><form id="FormValidator"  class="form-horizontal">',l+='<div class="form-group"><label class="col-sm-2 control-label">\u6545\u969c\u4fe1\u606f</label><div class="col-sm-9"><textarea id="remark" name="remark" class="form-control" rows="10"></textarea></div>',l+="</form></div></div>",BootstrapDialog.show({title:"\u6545\u969c\u4fe1\u606f\u5904\u7406",message:l,onshown:function(a){$("#FormValidator").bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{remark:{message:"\u6545\u969c\u4fe1\u606f\u65e0\u6548",validators:{notEmpty:{message:"\u6545\u969c\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a"}}}}})},buttons:[{label:"\u63d0\u4ea4",cssClass:"btn-primary",action:function(l){if($("#FormValidator").bootstrapValidator("validate"),$("#FormValidator").data("bootstrapValidator").isValid()){var e;e=$("#remark").val();var t="";t="workflowId="+a+"&remark="+e,$.ajax({type:"POST",url:"deviceFaultInfo/handFaultInfo.action",data:t,dataType:"json",success:function(a){var e="";e=600009==a.result?a.message:ConfigCN[a.result],600005==a.result&&($("#table-gzsb").bootstrapTable("refresh"),l.close()),BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:e,buttons:[{label:"\u5173\u95ed",action:function(a){a.close()}}]})}})}else BootstrapDialog.alert({title:"\u9a8c\u8bc1\u5931\u8d25",message:"\u8bf7\u786e\u8ba4\u8f93\u5165\u5185\u5bb9\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff01",type:BootstrapDialog.TYPE_DANGER,buttonLabel:"\u786e\u8ba4"})}},{label:"\u91cd\u7f6e",action:function(a){$("#FormValidator").data("bootstrapValidator").resetForm(!0)}},{label:"\u5173\u95ed",action:function(a){a.close()}}]})}function queryParams_gzsb(a){var l="";0==TempFaultStatusFlag&&(l=$("#FaultStatus").val());var e={limit:a.limit,offset:a.offset,devMac:$("#Mac").val(),begReportTime:$("#datetimeStart").val(),endReportTime:$("#datetimeEnd").val(),faultDescription:$("#faultDescription").val(),reportBureau:$("#RailwayBureau").val(),reportStation:$("#RailwayStation").val(),reportShop:$("#TrainShop").val(),faultStatus:l,faultStatusFlag:TempFaultStatusFlag};return e}var TempFaultStatusFlag=0,$table=$("#table-gzsb");$table.bootstrapTable({method:"post",contentType:"application/x-www-form-urlencoded",url:"deviceFaultInfo/getDeviceFaultInfoPage.action",dataType:"json",striped:!0,toolbar:"#toolbar",uniqueId:"id",pagination:!0,singleSelect:!1,idField:"id",sortable:!1,sidePagination:"server",queryParams:queryParams_gzsb,columns:[{title:"\u5e8f\u53f7",field:"id",align:"center",valign:"middle",width:80,formatter:function(a,l,e){return e+1}},{title:"\u8bbe\u5907\u5e8f\u5217\u53f7",field:"devMac",align:"center",valign:"middle",width:160},{title:"\u6545\u969c\u63cf\u8ff0",field:"faultDescription",align:"center",valign:"middle",width:300},{title:"\u4e0a\u62a5\u65f6\u95f4",field:"reportTime",align:"center",valign:"middle",width:160},{title:"\u4e0a\u62a5\u4eba\u5458",field:"userName",align:"center",valign:"middle"},{title:"\u5904\u7406\u72b6\u6001",field:"faultStatus",align:"center",valign:"middle",formatter:function(a,l,e){return faultStatusCN(a)}},{title:"\u64cd\u4f5c",field:"faultStatus",align:"center",valign:"middle",formatter:function(a,l,e){var t="";return t="02"==a||"04"==a?'<button class="btn btn-primary disabled" type="submit">\u7f16\u8f91</button> <button class="btn btn-primary" type="submit" onclick="gzsb_read(\''+l.workflowId+"','"+l.devMac+"','"+l.faultStatus+"');\">\u8be6\u60c5</button>":'<button class="btn btn-primary" type="submit" onclick="gzsb_edit(\''+l.workflowId+'\');">\u7f16\u8f91</button> <button class="btn btn-primary" type="submit" onclick="gzsb_read(\''+l.workflowId+"','"+l.devMac+"','"+l.faultStatus+"');\">\u8be6\u60c5</button>"}}]}),void 0!=TempFaultStatusFlag&&(TempFaultStatusFlag=parseInt(TempFaultStatusFlag),$("label").removeClass("active"),$("label").eq(TempFaultStatusFlag).addClass("active"),$(".radioItem").removeAttr("checked"),$(".radioItem").eq(TempFaultStatusFlag).attr("checked","checked")),$(".radioItem").change(function(){TempFaultStatusFlag=$(this).val(),$(".radioItem").removeAttr("checked"),$(this).attr("checked","checked"),0==TempFaultStatusFlag?$("#FaultStatusDiv,#gzsb_dr,#gzsb_Template").show():$("#FaultStatusDiv,#gzsb_dr,#gzsb_Template").hide(),$("#table-gzsb").bootstrapTable("refresh")}),$("#gzsb_dr").click(function(){var a="";a+='<div class="table row"><div class="form-horizontal">',a+='<div class="form-group col-sm-12"><div class="col-sm-12" id="DrTip">\u8bf7\u9009\u62e9\u9700\u8981\u5bfc\u5165\u7684Excel\u6587\u4ef6ã€‚</div></div>',a+='<div class="form-group col-sm-12"><div class="col-sm-12"><input id="file_excel" name="file_excel" class="file" type="file" accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"></div></div>',a+="</div></div>",BootstrapDialog.show({title:"\u6545\u969c\u4e0a\u62a5\u4fe1\u606f\u5bfc\u5165",message:a,onshown:function(a){$("#file_excel").fileinput({language:"zh",uploadUrl:"deviceFaultInfo/importFauthInfo.action",allowedFileExtensions:["xls","xlsx"],showPreview:!1,browseClass:"btn btn-primary",dropZoneEnabled:!1,maxFileCount:1,enctype:"multipart/form-data",validateInitialCount:!1}),$("#file_excel").on("filelock",function(a,l,e){$("#DrTip").html('<i class="fa fa-spinner fa-spin"></i> \u6545\u969c\u4fe1\u606f\u6b63\u5728\u5bfc\u5165\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85...')}),$("#file_excel").on("fileuploaded",function(l,e,t,s){$("#table-gzsb").bootstrapTable("refresh");var o="";600008==e.response.code?o=e.response.mess:(o="\u6210\u529f\uff1a"+e.response.sussNum+" \u5931\u8d25\uff1a"+e.response.failNum+"<br>",o+="0"==e.response.failNum?ConfigCN[e.response.code]:e.response.mess),BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:o,buttons:[{label:"\u5173\u95ed",action:function(a){a.close()}}]}),a.close()})},buttons:[{label:"\u4e0b\u8f7d\u5bfc\u5165\u6a21\u677f",cssClass:"btn-primary",action:function(a){window.open("excelTemplate/faultInfo.xls")}},{label:"\u5173\u95ed",action:function(a){a.close()}}]})}),$("#serach_button").click(function(){$("#table-gzsb").bootstrapTable("refresh")}),$.ajax({type:"post",url:"selectObject/getRailwayBureau.action",contentType:"application/json",dataType:"json",success:function(a){$.each(a,function(a,l){$("#RailwayBureau").append('<option value="'+l.value+'">'+l.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u5c40\u4fe1\u606f\uff01")}}),$("#RailwayBureau").change(function(){if(""!=$(this).val()){var a="";a="trainBureauId="+$(this).val(),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayStation.action",dataType:"json",data:a,success:function(a){$("#RailwayStation").html('<option value="">\u9009\u62e9\u914d\u5c5e\u6bb5</option>'),$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$.each(a,function(a,l){$("#RailwayStation").append('<option value="'+l.value+'">'+l.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u6bb5\u4fe1\u606f\uff01")}})}else $("#RailwayStation").html('<option value="">\u9009\u62e9\u914d\u5c5e\u6bb5</option>'),$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$(".selectpicker").selectpicker("refresh")}),$("#RailwayStation").change(function(){if(""!=$(this).val()){var a="";a="trainBureauId="+$("#RailwayBureau").val()+"&trainStationId="+$(this).val(),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayShop.action",dataType:"json",data:a,success:function(a){$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$("#RailwayLine").html('<option value="">\u9009\u62e9\u8f66\u6b21</option>'),$.each(a,function(a,l){$("#TrainShop").append('<option value="'+l.value+'">'+l.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u8f66\u95f4\u4fe1\u606f\uff01")}})}else $("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$(".selectpicker").selectpicker("refresh")}),$(".datetimeStart").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"hour",maxView:"decade",minuteStep:1,todayBtn:!0,language:"zh-CN"}).on("click",function(a){$(".datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val())}),$(".datetimeEnd").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"hour",maxView:"decade",minuteStep:1,todayBtn:!0,language:"zh-CN"}).on("click",function(a){$(".datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val())});