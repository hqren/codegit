function DevByUser(){var data="";data="car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/queryDevByUser.action",dataType:"json",data:data,success:function(jsonResult){var setting={view:{fontCss:getFont,nameIsHTML:!0},check:{enable:!0},data:{simpleData:{enable:!0}},callback:{beforeClick:beforeClick}},treeNodeArray=new Array,treeNodeObject=new Object;treeNodeObject.id=0,treeNodeObject.name="\u95ed\u95ed",treeNodeObject.open=!0,treeNodeArray.push(treeNodeObject),$.each(jsonResult,function(e,t){var o=new Object;if(o.id=t.id,o.pId=0,o.name=t.mac,1==t.devStatus){new Object;o.font={color:"red"}}treeNodeArray.push(o)});var zNodes=eval(treeNodeArray);$.fn.zTree.init($("#treeDemo"),setting,zNodes)},error:function(){errorNotify(null,"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed")}})}function CommandByUser(){var e="";e="car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/queryCommandByUser.action",dataType:"json",data:e,success:function(e){$("#CommandByUser").html(""),$.each(e,function(e,t){$("#CommandByUser").append('<a href="javascript:void(0);" class="list-group-item">'+t.command+"</a>")}),$("#CommandByUser a").click(function(){$("#CommandByUser a").removeClass("active"),$(this).addClass("active"),$("#data").html($(this).text()),TempCommand=$(this).text(),$("#CommandByUser_Del").removeClass("disabled"),$("#CommandByUser_Del").prop("disabled",!1)})},error:function(){errorNotify(null,"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed")}})}function beforeClick(e,t,o){$("#log").html(""),TempMac=t.name;var a="";a="mac="+TempMac,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/getExecDevJobHistory.action",dataType:"json",data:a,success:function(e){var t="";$.each(e,function(e,o){t+="<li><br>"+o.updateTime+" "+o.cmd+"</li>",t+="<li>"+o.finishTime+"</li>",t+="<li>"+o.remarks.replace(/\n/g,"<br>")+"<br>=*= END =*=<br><br></li>"}),$("#log").html(t)},error:function(){errorNotify(null,"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed")}})}function getFont(e,t){return t.font?t.font:{}}var TempCommand="",TempMac="";DevByUser(),CommandByUser(),$("#Mac_Add").click(function(){return""==$("#Mac").val()?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95edMAC\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close(),$("#Mac").focus()}}]}),!1):void BootstrapDialog.confirm({title:"\u95ed\u95edMAC\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95edMAC\u95ed",closable:!0,draggable:!0,btnCancelLabel:"\u95ed\u95ed",btnOKLabel:"\u95ed\u95ed",callback:function(e){if(e){var t="";t="mac="+$("#Mac").val()+"&car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/addUserDev.action",timeout:6e4,dataType:"json",data:t,success:function(e){var t="";return t=600009==e.result?e.message:ConfigCN[e.result],6e5!=e.result?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}),!1):(DevByUser(),void BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}))},error:function(e,t,o){"timeout"==t&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})}})}}})}),$("#Mac_Del").click(function(){var e=$.fn.zTree.getZTreeObj("treeDemo"),t=e.getCheckedNodes(),o=new Array;return $.each(t,function(e,t){void 0==t.children&&o.push(t.name)}),o.length>0?void BootstrapDialog.confirm({title:"\u95ed\u95edMAC\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95edMAC\u95ed",closable:!0,draggable:!0,btnCancelLabel:"\u95ed\u95ed",btnOKLabel:"\u95ed\u95ed",callback:function(e){if(e){var t="";t="mac="+String(o),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/delUserDev.action",timeout:6e4,dataType:"json",data:t,success:function(e){var t="";return t=600009==e.result?e.message:ConfigCN[e.result],600002!=e.result?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}),!1):(DevByUser(),void BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){CommandByUser(),TempCommand="",e.close()}}]}))},error:function(e,t,o){"timeout"==t&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})}})}}}):(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95edMAC\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}),!1)}),$("#CommandByUser_Add").click(function(){return""==$("#CommandByUser_Text").val()?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close(),$("#CommandByUser_Text").focus()}}]}),!1):void BootstrapDialog.confirm({title:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed",closable:!0,draggable:!0,btnCancelLabel:"\u95ed\u95ed",btnOKLabel:"\u95ed\u95ed",callback:function(e){if(e){var t="";t="command="+encodeURIComponent($("#CommandByUser_Text").val()),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/addUserCommand.action",timeout:6e4,dataType:"json",data:t,success:function(e){var t="";return t=600009==e.result?e.message:ConfigCN[e.result],6e5!=e.result?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}),!1):(CommandByUser(),void BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}))},error:function(e,t,o){"timeout"==t&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})}})}}})}),$("#CommandByUser_Del").click(function(){0!=$("#CommandByUser a").length&&""!=TempCommand?BootstrapDialog.confirm({title:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed",closable:!0,draggable:!0,btnCancelLabel:"\u95ed\u95ed",btnOKLabel:"\u95ed\u95ed",callback:function(e){e&&$("#CommandByUser a").each(function(e,t){if($(this).hasClass("active")){var o="";o="command="+encodeURIComponent(TempCommand),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"execJob/delUserCommand.action",timeout:6e4,dataType:"json",data:o,success:function(e){var t="";return t=600009==e.result?e.message:ConfigCN[e.result],600002!=e.result?(BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}),!1):void BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:t,buttons:[{label:"\u95ed\u95ed",action:function(e){CommandByUser(),TempCommand="",e.close()}}]})},error:function(e,t,o){"timeout"==t&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})}})}})}}):($("#CommandByUser_Del").addClass("disabled"),$("#CommandByUser_Del").prop("disabled",!0),errorNotify(null,"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed"))}),$("#SSHReturn").click(function(){if(""!=TempMac&&""!=$("#data").val()){var e="",t=TempMac,o=encodeURIComponent($("#data").val());e="macs="+t+"&data="+o,$.ajax({type:"POST",url:"execJob/addDevJob.action",timeout:6e4,dataType:"json",data:e,success:function(a){if(0!=a.code)return errorNotify("\u95ed\u95ed\u95ed",a.message,null),!1;errorNotify("\u95ed\u95ed\u95ed","\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed","success");var n=a.execJobId,s=a.updateTime,l="",r=function(){0==$("#log_"+c).length&&$("#log").prepend("<li>"+s+" "+HTMLEncode($("#data").val())+'</li><div id="log_'+c+'"><div class="load"><li><i class="icon-spinner icon-spin"></i> \u95ed\u95ed\u95ed\u95ed...</li></div></div>'),e="mac="+t+"&data="+o+"&execJobId="+n+"&remarks="+l+"&intervalId="+c,$.ajax({type:"POST",url:"execJob/getExecDevJobResult.action",timeout:6e4,dataType:"json",data:e,success:function(e){if(null!=e&&("0"==e.result||"1"==e.result)){var t="";if($("#log_"+e.intervalId+" .load").remove(),clearInterval(e.intervalId),t+="<li>"+e.finishTime+"</li>",""!=e.remarks){var o=e.remarks.split(",");o.forEach(function(e){""!=e&&(e=HTMLEncode(e),t+="<li>"+e.replace(/\n/g,"<br>")+"<br>=*= END =*=<br><br></li>")})}else t+="<li><br>=*= END =*=<br><br></li>";return $("#log_"+c).html(t),!1}}})},c=setInterval(r,1e4);r()},error:function(e,t,o){"timeout"==t&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})}})}else""==$("#data").val()?BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed。",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]}):""==TempMac&&BootstrapDialog.show({title:"\u95ed\u95ed\u95ed\u95ed",message:"\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95edMAC\u95ed\u95ed\u95ed\u95edMAC\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed\u95ed。",buttons:[{label:"\u95ed\u95ed",action:function(e){e.close()}}]})});