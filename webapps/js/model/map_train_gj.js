function GetAmap(){var data="",MacList=String($("#MacList").val()),Mac=$("#Mac").val(),ActionUrl="devGps/getHistoryListByMacs.action";if(data+=null!=radiusStr?"&radiusStr="+radiusStr:"&radiusStr=0.1",data+=null!=maxRangeStr?"&maxRangeStr="+maxRangeStr:"&maxRangeStr=20",data+=null!=maxSpeed?"&maxSpeed="+maxSpeed:"&maxSpeed=40",data+=null!=strength?"&strength="+strength:2==car_type?"&strength=off":"&strength=on",1==car_type)null!=MacList&&"null"!=MacList||(MacList=""),""!=MacList&&""!=Mac?MacList+=","+Mac:""==MacList&&""!=Mac?MacList=Mac:MacList+=Mac,data+="&macStr="+MacList,data+="&dateFrom="+$("#datetimeStart").val()+"&dateTo="+$("#datetimeEnd").val();else if(2==car_type){ActionUrl="devGps/getBusHistoryListByMacs.action",cmpId=CmpId;var SN=$("#SNCar").val(),Mac=$("#MacCar").val(),CbPlateNum=$("#CbPlateNum").val();data+="&equSn="+SN+"&cbPlateNum="+CbPlateNum+"&macStr="+Mac,data+="&dateFrom="+$("#datetimeStart2").val()+"&dateTo="+$("#datetimeEnd2").val(),""!=$("#Province").val()&&(data+="&cmpId="+CmpId)}data+="&car_type="+car_type,$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:ActionUrl,timeout:6e4,dataType:"json",data:data,success:function(jsonResult){if(""!=jsonResult.city){var cityGeo=jsonResult.city.split(",");cityCenter=[parseFloat(cityGeo[0]),parseFloat(cityGeo[1])];var map=new AMap.Map("allmap",{resizeEnable:!0,zoom:5,center:cityCenter});AMap.plugin(["AMap.ToolBar","AMap.Scale","AMap.OverView","AMap.RangingTool"],function(){ruler1=new AMap.RangingTool(map),AMap.event.addListener(ruler1,"end",function(a){ruler1.turnOff()});({icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b1.png"})}),{icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b2.png"}),offset:new AMap.Pixel(-9,-31)};map.addControl(new AMap.ToolBar),map.addControl(new AMap.Scale),map.addControl(new AMap.OverView({isOpen:!0}))});var strHtml="";MacsArray=jsonResult.macs,MacsDataArray=[],TempMacsArray=[],massDataArray=[],points=[],MacsArray=MacsArray.slice(0,18),TempMacsArray=MacsArray,$.each(MacsArray,function(i,item){function ShowMass(index){var massDataArrayTemp=eval("massDataArray_"+index),mass=new AMap.MassMarks(massDataArrayTemp,{url:"img/wifi_0"+index+".png",anchor:new AMap.Pixel(8,7),size:new AMap.Size(15,20),opacity:1,cursor:"pointer",zIndex:99999999});mass.on("mouseover",function(a){var e=a.data.content,t=a.data.lnglat;e+="<div>\u5750\u6807\uff1a"+t.lng+" "+t.lat+"</div>",e+="<div>"+t.G+","+t.J+"</div>",e+='<div>\u6240\u5728\u4f4d\u7f6e\uff1a<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+t.lng+","+t.lat,contentType:"application/json",dataType:"jsonp",success:function(a){$("#geoStr").html(a.regeocode.formatted_address)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}}),infoWindow.setContent(e),infoWindow.open(map,t)}),mass.setMap(map)}MacsDataArray.push(jsonResult.data[i][item]),strHtml+='<div class="monitorListItem active"><div class="monitorListItemName"><i class="listIco"> </i>'+item+'</div><div class="monitorListItemSpeed text-right"><i class="fa fa-play" onclick="GuiJi(\''+item+"')\"> </i></div></div>";var lineArr=[],massArr=[],massDataArray_0=[],massDataArray_1=[],massDataArray_2=[],massDataArray_3=[],massDataArray_4=[],massDataArray_5=[];$.each(jsonResult.data[i][item],function(a,e){var t=[];t=""!=e.lon_lat?e.lon_lat.split(","):[parseFloat(e.longitude),parseFloat(e.latitude)];var n,r;n=-1!=e.sim1_signal_strength?e.sim1_signal_strength+"("+signalStrengthCN(e.sim1_signal_strength)+")":"-(\u672a\u91c7\u96c6)",r=-1!=e.sim2_signal_strength?e.sim2_signal_strength+"("+signalStrengthCN(e.sim2_signal_strength)+")":"-(\u672a\u91c7\u96c6)",lineArr.push(t);var o="<div>MAC\uff1a"+item+"</div><div>\u65f6\u95f4\uff1a"+moment(e.date).format("YYYY-MM-DD HH:mm:ss")+"</div><div>SIM\u53611\u4fe1\u53f7\uff1a"+n+"</div><div>SIM\u53612\u4fe1\u53f7\uff1a"+r+"</div>";massDataArray.push({lnglat:t,name:item,content:o});var s=e.sim1_signal_strength;0==s&&(s=e.sim2_signal_strength),s>=-1&&6>=s?massDataArray_1.push({lnglat:t,name:item,content:o}):s>=7&&11>=s?massDataArray_2.push({lnglat:t,name:item,content:o}):s>=12&&18>=s?massDataArray_3.push({lnglat:t,name:item,content:o}):s>=19&&31>=s?massDataArray_4.push({lnglat:t,name:item,content:o}):99==s&&massDataArray_0.push({lnglat:t,name:item,content:o}),0==a?new AMap.Marker({map:map,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-46,-100)})}):a==jsonResult.data[i][item].length-1&&new AMap.Marker({map:map,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-125,-100)})})});var polyline=new AMap.Polyline({path:lineArr,strokeColor:colorPalette[i],strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",strokeDasharray:[10,5]});polyline.setMap(map);var infoWindow=new AMap.InfoWindow({offset:new AMap.Pixel(0,-30)});ShowMass(0),ShowMass(1),ShowMass(2),ShowMass(3),ShowMass(4),console.log(["massDataArray_1",massDataArray_1],["massDataArray_2",massDataArray_2],["massDataArray_3",massDataArray_3],["massDataArray_4",massDataArray_4])});var newCenter=map.setFitView();$("#BDMapRightBody").html(strHtml),$(".monitorListItemName").click(function(){$(".monitorListItem").removeClass("active"),$(this).parent().addClass("active"),GetAmap2($(this).text().trim())}),$(".monitorListItemSpeed i").click(function(){$(".monitorListItem").removeClass("active"),$(this).parent().parent().addClass("active")})}else errorNotify("","\u672a\u67e5\u8be2\u5230\u8f68\u8ff9\u4fe1\u606f\uff01","info")},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}})}function GetAmap2(Mac){var map=new AMap.Map("allmap",{resizeEnable:!0,center:cityCenter});AMap.plugin(["AMap.ToolBar","AMap.Scale","AMap.OverView","AMap.RangingTool"],function(){ruler1=new AMap.RangingTool(map),AMap.event.addListener(ruler1,"end",function(a){ruler1.turnOff()});({icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b1.png"})}),{icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b2.png"}),offset:new AMap.Pixel(-9,-31)};map.addControl(new AMap.ToolBar),map.addControl(new AMap.Scale),map.addControl(new AMap.OverView({isOpen:!0}))}),massDataArray=[],$.each(TempMacsArray,function(i,item){function ShowMass(index){var massDataArrayTemp=eval("massDataArray_"+index),mass=new AMap.MassMarks(massDataArrayTemp,{url:"img/wifi_0"+index+".png",anchor:new AMap.Pixel(8,7),size:new AMap.Size(15,20),opacity:1,cursor:"pointer",zIndex:99999999});mass.on("mouseover",function(a){var e=a.data.content,t=a.data.lnglat;e+="<div>\u5750\u6807\uff1a"+t.lng+" "+t.lat+"</div>",e+="<div>"+t.G+","+t.J+"</div>",e+='<div>\u6240\u5728\u4f4d\u7f6e\uff1a<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+t.lng+","+t.lat,contentType:"application/json",dataType:"jsonp",success:function(a){$("#geoStr").html(a.regeocode.formatted_address)},error:function(){$("#geoStr").html("-"),console.log("\u9ad8\u5fb7\u5730\u56feAPI\u8fd4\u56de\u5f02\u5e38\uff01")}}),infoWindow.setContent(e),infoWindow.open(map,t)}),mass.setMap(map)}if(item===Mac){var lineArr=[],massArr=[],massDataArray_0=[],massDataArray_1=[],massDataArray_2=[],massDataArray_3=[],massDataArray_4=[],massDataArray_5=[];$.each(MacsDataArray[i],function(a,e){var t=[];if(""!=e.lon_lat){var n=e.lon_lat.split(",");t=[parseFloat(n[0]),parseFloat(n[1])]}else t=[parseFloat(e.longitude),parseFloat(e.latitude)];var r,o;r=-1!=e.sim1_signal_strength?e.sim1_signal_strength+"("+signalStrengthCN(e.sim1_signal_strength)+")":"-(\u672a\u91c7\u96c6)",o=-1!=e.sim2_signal_strength?e.sim2_signal_strength+"("+signalStrengthCN(e.sim2_signal_strength)+")":"-(\u672a\u91c7\u96c6)",TempLineArr.push(t),lineArr.push(t);var s="<div>MAC\uff1a"+item+"</div><div>\u65f6\u95f4\uff1a"+moment(e.date).format("YYYY-MM-DD HH:mm:ss")+"</div><div>SIM\u53611\u4fe1\u53f7\uff1a"+r+"</div><div>SIM\u53612\u4fe1\u53f7\uff1a"+o+"</div>";massDataArray.push({lnglat:t,name:item,content:s});var l=e.sim1_signal_strength;0==l&&(l=e.sim2_signal_strength),l>=-1&&6>=l?massDataArray_1.push({lnglat:t,name:item,content:s}):l>=7&&11>=l?massDataArray_2.push({lnglat:t,name:item,content:s}):l>=12&&18>=l?massDataArray_3.push({lnglat:t,name:item,content:s}):l>=19&&31>=l?massDataArray_4.push({lnglat:t,name:item,content:s}):99==l&&massDataArray_0.push({lnglat:t,name:item,content:s}),0==a?new AMap.Marker({map:map,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-46,-100)})}):a==MacsDataArray[i].length-1&&new AMap.Marker({map:map,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-125,-100)})})});var polyline=new AMap.Polyline({path:lineArr,strokeColor:colorPalette[i],strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",strokeDasharray:[10,5]});polyline.setMap(map);var infoWindow=new AMap.InfoWindow({offset:new AMap.Pixel(0,-30)});ShowMass(0),ShowMass(1),ShowMass(2),ShowMass(3),ShowMass(4)}});var newCenter=map.setFitView()}function GetBaiDu(){var a=new BMap.Map("allmap");a.centerAndZoom("\u4e2d\u56fd",5),a.setMapStyle({style:"bluish"}),a.enableScrollWheelZoom();var e=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT}),t=new BMap.NavigationControl,n=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});$.ajax({type:"get",url:"json/getHistoryListByMacs.json",contentType:"application/json",dataType:"json",success:function(e){function t(e,t){var n=t.point,i=new BMap.Point(n.lng,n.lat);e+=n.content+'<div>\u6240\u5728\u4f4d\u7f6e\uff1a<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+n.lng+","+n.lat,contentType:"application/json",dataType:"jsonp",success:function(a){console.log(a.regeocode.formatted_address),$("#geoStr").html(a.regeocode.formatted_address)},error:function(){$("#geoStr").html("-"),console.log("\u9ad8\u5fb7\u5730\u56feAPI\u8fd4\u56de\u5f02\u5e38\uff01")}});var r=new BMap.InfoWindow(e,opts);a.openInfoWindow(r,i)}var n="";MacsArray=[],MacsDataArray=[],TempMacsArray=[],points=[];for(var i in e)""!=e[i]&&MacsArray.push(i);MacsArray=MacsArray.slice(0,4),TempMacsArray=MacsArray,$.each(MacsArray,function(t,i){MacsDataArray.push(e[i]),n+='<div class="monitorListItem active"><div class="monitorListItemName"><i> </i>'+i+'</div><div class="monitorListItemSpeed"></div></div>';var r=[];$.each(e[i],function(t,n){var o=new BMap.Point(n.longitude,n.latitude);o.content="<div>MAC\uff1a"+n.mac+"</div><div>\u65f6\u95f4\uff1a"+moment(n.date).format("YYYY-MM-DD HH:mm:ss")+"</div>",r.push(o),points.push(o);new BMap.Marker(o);if(0==t){new BMap.Marker(o,{icon:startIcon})}else if(t==e[i].length-1){var s=new BMap.Marker(o,{icon:endIcon});a.addOverlay(s)}});var o=new BMap.Polyline(r,{strokeColor:colorPalette[t],strokeWeight:4,strokeOpacity:.8});a.addOverlay(o)}),$("#BDMapRightBody").html(n),$(".monitorListItem").click(function(){$(".monitorListItem").removeClass("active"),$(this).addClass("active"),GetBaiDu2($(this).find(".monitorListItemName").text().trim())});var r=new BMap.PointCollection(points,options);r.addEventListener("mouseover",function(a){t("",a)}),a.addOverlay(r)},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u6570\u636e\uff0c\u8bf7\u5237\u65b0\u9875\u9762\uff01")}}),a.addControl(e),a.addControl(t),a.addControl(n)}function GetBaiDu2(a){function e(a,e){var n=e.point,i=new BMap.Point(n.lng,n.lat);a+=n.content+'<div>\u6240\u5728\u4f4d\u7f6e\uff1a<span id="geoStr"><i class="fa fa-spinner fa-spin"></i></span></div>',$.ajax({type:"post",url:"http://restapi.amap.com/v3/geocode/regeo?key=ad5a84667e78110b985685cceeed565c&location="+n.lng+","+n.lat,contentType:"application/json",dataType:"jsonp",success:function(a){console.log(a.regeocode.formatted_address),$("#geoStr").html(a.regeocode.formatted_address)},error:function(){$("#geoStr").html("-"),console.log("\u9ad8\u5fb7\u5730\u56feAPI\u8fd4\u56de\u5f02\u5e38\uff01")}});var r=new BMap.InfoWindow(a,opts);t.openInfoWindow(r,i)}a=String(a);var t=new BMap.Map("allmap");t.clearOverlays(),t.centerAndZoom("\u4e2d\u56fd",5),t.enableScrollWheelZoom(),t.setMapStyle({style:"bluish"});var n=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT}),i=new BMap.NavigationControl,r=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});points=[],$.each(TempMacsArray,function(e,n){if(n===a){var i=[];$.each(MacsDataArray[e],function(a,n){var r=new BMap.Point(n.longitude,n.latitude);r.content="<div>MAC\uff1a"+n.mac+"</div><div>\u65f6\u95f4\uff1a"+moment(n.date).format("YYYY-MM-DD HH:mm:ss")+"</div>",i.push(r),points.push(r);new BMap.Marker(r);if(0==a){var o=new BMap.Marker(r,{icon:startIcon});t.addOverlay(o)}else if(a==MacsDataArray[e].length-1){var s=new BMap.Marker(r,{icon:endIcon});t.addOverlay(s)}});var r=new BMap.Polyline(i,{strokeColor:colorPalette[e],strokeWeight:4,strokeOpacity:.8});t.addOverlay(r)}});var o=new BMap.PointCollection(points,options);o.addEventListener("mouseover",function(a){e("",a)}),t.addOverlay(o),t.addControl(n),t.addControl(i),t.addControl(r)}function GuiJi(a){var e,t=[];$.each(TempMacsArray,function(n,i){function r(){var a="img/car.png";1==car_type&&(a="img/train.png"),e=new AMap.Marker({map:o,position:t[0],icon:a,offset:new AMap.Pixel(-26,-13),autoRotation:!0});new AMap.Polyline({map:o,path:t,strokeColor:colorPalette[n],strokeOpacity:1,strokeWeight:3,strokeStyle:"solid",strokeDasharray:[10,5]});o.setFitView();o.setFitView();e.moveAlong(t,5e4)}if(i===a){var o=new AMap.Map("allmap",{resizeEnable:!0,center:cityCenter,zoom:17});o.on("complete",r),$.each(MacsDataArray[n],function(a,e){0==a?new AMap.Marker({map:o,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-46,-100)})}):a==MacsDataArray[n].length-1&&new AMap.Marker({map:o,position:[parseFloat(e.longitude),parseFloat(e.latitude)],icon:new AMap.Icon({size:new AMap.Size(25,25),image:"http://webapi.amap.com/theme/v1.3/images/newpc/diricon.png",imageOffset:new AMap.Pixel(-125,-100)})});var i,r;if(""!=e.lon_lat){var s=e.lon_lat.split(",");i=parseFloat(s[0]).toFixed(6),r=parseFloat(s[1]).toFixed(6)}else i=parseFloat(e.longitude).toFixed(6),r=parseFloat(e.latitude).toFixed(6);t.push([i,r])})}})}var radiusStr=getUrlParam("radiusStr"),maxRangeStr=getUrlParam("maxRangeStr"),maxSpeed=getUrlParam("maxSpeed"),strength=getUrlParam("strength"),TempLineArr=[],CmpId="",CmpName="";$("#BDMapRight .panel-heading").click(function(){$("#BDMapRightBody").is(":hidden")?$("#BDMapRightIco").removeClass("fa-angle-down").addClass("fa-angle-up"):$("#BDMapRightIco").removeClass("fa-angle-up").addClass("fa-angle-down"),$("#BDMapRightBody").toggle(200)}),2==car_type?($("#train_control").hide(),$("#car_control").show(),getProvince()):($.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayBureau.action",dataType:"json",success:function(a){$.each(a,function(a,e){$("#RailwayBureau").append('<option value="'+e.value+'">'+e.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u5c40\u4fe1\u606f\uff01")}}),getRailwayLine("","",""),$("#RailwayBureau").change(function(){if(getRailwayLine($(this).val(),"",""),""!=$(this).val()){var a="";a="trainBureauId="+$(this).val(),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayStation.action",dataType:"json",data:a,success:function(a){$("#RailwayStation").html('<option value="">\u9009\u62e9\u914d\u5c5e\u6bb5</option>'),$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$("#MacList").html(""),$.each(a,function(a,e){$("#RailwayStation").append('<option value="'+e.value+'">'+e.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u6bb5\u4fe1\u606f\uff01")}})}else $("#RailwayStation").html('<option value="">\u9009\u62e9\u914d\u5c5e\u6bb5</option>'),$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$("#MacList").html(""),$(".selectpicker").selectpicker("refresh")}),$("#RailwayStation").change(function(){if(getRailwayLine($("#RailwayBureau").val(),$(this).val(),""),""!=$(this).val()){var a="";a="trainBureauId="+$("#RailwayBureau").val()+"&trainStationId="+$(this).val(),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayShop.action",dataType:"json",data:a,success:function(a){$("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$("#MacList").html(""),$.each(a,function(a,e){$("#TrainShop").append('<option value="'+e.value+'">'+e.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6\u914d\u5c5e\u8f66\u95f4\u4fe1\u606f\uff01")}})}else $("#TrainShop").html('<option value="">\u9009\u62e9\u914d\u5c5e\u8f66\u95f4</option>'),$("#MacList").html(""),$(".selectpicker").selectpicker("refresh")}),$("#TrainShop").change(function(){getRailwayLine($("#RailwayBureau").val(),$("#RailwayStation").val(),$(this).val()),$("#MacList").html("")}),$("#RailwayLine").change(function(){if(""!=$(this).val()){var a="";a="trainBureauId="+$("#RailwayBureau").val()+"&trainStationId="+$("#RailwayStation").val()+"&trainShopId="+$("#TrainShop").val()+"&trainLineId="+$(this).val(),$.ajax({type:"post",contentType:"application/x-www-form-urlencoded",url:"selectObject/getRailwayMacList.action",dataType:"json",data:a,success:function(a){$("#MacList").html(""),$.each(a,function(a,e){$("#MacList").append('<option value="'+e.value+'">'+e.text+"</option>")}),$(".selectpicker").selectpicker("refresh")},error:function(){errorNotify(null,"\u65e0\u6cd5\u83b7\u53d6MAC\u4fe1\u606f\uff01")}})}else $("#MacList").html(""),$(".selectpicker").selectpicker("refresh")}),$(".selectpicker").selectpicker("refresh"),$("#train_control").show(),$("#car_control").hide());var colorPalette=["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],cityCenter,MacsArray=[],MacsDataArray=[],TempMacsArray=[],points=[],massDataArray=[],ruler1;if($("#allmap").length<=0){$("#BDMap").append('<div id="allmap" style="height:'+($(window).height()-$("#MapTool").outerHeight())+'px;"></div>');var map=new AMap.Map("allmap",{resizeEnable:!0,zoom:5,center:cityCenter});AMap.plugin(["AMap.ToolBar","AMap.Scale","AMap.OverView","AMap.RangingTool"],function(){ruler1=new AMap.RangingTool(map),AMap.event.addListener(ruler1,"end",function(a){ruler1.turnOff()});({icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b1.png"})}),{icon:new AMap.Icon({size:new AMap.Size(19,31),image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b2.png"}),offset:new AMap.Pixel(-9,-31)};map.addControl(new AMap.ToolBar),map.addControl(new AMap.Scale),map.addControl(new AMap.OverView({isOpen:!0}))})}$("#serach_gj_train").click(function(){$("#BDMapRightBody").html("");var a=String($("#MacList").val()),e=$("#Mac").val();""==a&&""==e?errorNotify(null,"\u8bf7\u9009\u62e9\u6216\u8f93\u5165\u5b8c\u6574Mac\uff01"):""==$("#datetimeStart").val()&&""==$("#datetimeEnd").val()?errorNotify(null,"\u8bf7\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"):GetAmap()}),$("#serach_gj_car").click(function(){$("#BDMapRightBody").html(""),""==$("#CbPlateNum").val()&&""==$("#SNCar").val()&&""==$("#MacCar").val()?errorNotify(null,"\u8bf7\u8f93\u5165\u8f66\u724c、\u8bbe\u5907SN\u6216\u8bbe\u5907Mac!"):""!=$("#Province").val()&&""!=$("#CmpByProvince").val()?CmpName==$("#CmpByProvince").val()?""==$("#datetimeStart2").val()&&""==$("#datetimeEnd2").val()?errorNotify(null,"\u8bf7\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"):GetAmap():errorNotify(null,"\u8fd0\u4f01\u4fe1\u606f\u9519\u8bef\uff01"):""!=$("#Province").val()&&""==$("#CmpByProvince").val()?errorNotify(null,"\u8bf7\u8f93\u5165\u8fd0\u4f01\u4fe1\u606f\uff01"):""==$("#datetimeStart2").val()&&""==$("#datetimeEnd2").val()?errorNotify(null,"\u8bf7\u9009\u62e9\u65e5\u671f\u8303\u56f4\uff01"):GetAmap()}),$("#serach_gj_train_csjl").click(function(){ruler1.turnOn()}),$("#datetimeStart").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){var e=moment().format("YYYY-MM-DD");""!=$("#datetimeEnd").val()?(e=dateAddDays($("#datetimeEnd").val(),-7),$("#datetimeStart").datetimepicker("setEndDate",$("#datetimeEnd").val()).datetimepicker("setStartDate",e)):$("#datetimeStart").datetimepicker("setEndDate",e)}),$("#datetimeEnd").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){var e=moment().format("YYYY-MM-DD");""!=$("#datetimeStart").val()&&(e=dateAddDays($("#datetimeStart").val(),7)),$("#datetimeEnd").datetimepicker("setStartDate",$("#datetimeStart").val()).datetimepicker("setEndDate",e)}),$("#datetimeStart2").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){var e=moment().format("YYYY-MM-DD");""!=$("#datetimeEnd2").val()?(e=dateAddDays($("#datetimeEnd").val(),-7),$("#datetimeStart2").datetimepicker("setEndDate",$("#datetimeEnd2").val()).datetimepicker("setStartDate",e)):$("#datetimeStart2").datetimepicker("setEndDate",e)}),$("#datetimeEnd2").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"decade",language:"zh-CN"}).on("click",function(a){var e=moment().format("YYYY-MM-DD");""!=$("#datetimeStart2").val()&&(e=dateAddDays($("#datetimeStart2").val(),7)),$("#datetimeEnd2").datetimepicker("setStartDate",$("#datetimeStart2").val()).datetimepicker("setEndDate",e)});var sourceArray=new Array;$("#Province").change(function(){if($("#CmpByProvince").val(""),sourceArray=new Array,""!=$("#Province").val()){var a="";a="provinceId="+$("#Province").val(),$.ajax({type:"post",url:"devGps/getCmpByProvince.action",data:a,dataType:"json",success:function(a){$.each(a,function(a,e){sourceArray.push({id:e.cmpId,name:e.cmpName})})},error:function(a,e,t){"timeout"==e&&BootstrapDialog.show({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u8bf7\u6c42\u8d85\u65f6\uff01",buttons:[{label:"\u5173\u95ed",action:function(a){a.close()}}]})}})}}),$("#CmpByProvince").typeahead({source:function(a,e){return e(sourceArray)},updater:function(a){return CmpId=a.id,CmpName=a.name,a}});